<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
        * {
            width: 800px;
            height: 100vh;
            box-sizing: border-box;
        }

        body {
            background-image: url('espaco.jpg');
            background-repeat: no-repeat;
            background-position: center;
        }

        /* body {
            background-image: ;
        } */
    </style>
    <title>Document</title>
</head>
<!-- body teste -->
<body id="body">
    <button id='btnIniciar' class="btn btn-secondary btn-lg" style="width: 200px; height: 60px;"
        onclick="jogo()">iniciarJogo</button>
    <canvas id="gameCanvas" width="800" height="400" style="border: 3px solid blue;"></canvas>
</body>
<script>
    function jogo()    {
            var body = document.getElementById("body");
            var can = document.createElement("canvas");
            can.width = '800px';
            can.height = '400px';
            can.style = "border: 3px solid blue";
            can.id = 'gameCanvas'
        body.appendChild(can)
        var canvas = document.getElementById("gameCanvas")
        var ctx = canvas.getContext('2d')

        var tInicial = new Date().getTime();
            var intervalo, tAtual;
            var pontos = 0; // Variável para contar os pontos
            var gameOver = false;

            //Meteoro
            var x = Math.random() * (canvas.width - 200);
            var y = 0;
            var wMeteoro = new Image();
            wMeteoro.src = 'meteoro2.png';

            //Largura e altura das imagens são iguais
            var width = 50;
            var height = 50;

            //Aviao
            var wAviao = new Image();
            wAviao.src = 'aviao.png'
        var xAviao = 150;
            var yAviao = 300;

            var btnIniciar = document.getElementById('btnIniciar');
            btnIniciar.addEventListener('click', function () {
                iniciarJogo();
            });

            requestAnimationFrame(gameloop);
        function gameloop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if(!gameOver) {
                if (y <= 400) {
                    if (wMeteoro.complete) {
                        ctx.drawImage(wMeteoro, x, y, width, height);
                    }
                } else {
                    // Gerar novo meteoro no topo da tela
                    x = Math.random() * (canvas.width - 200);
                    y = 0;
                    pontos++; // Incrementar os pontos quando um meteoro passa pelo avião
                }
                y += 5; // Incrementar a variável y indicando o deslocamento para baixo
                moverAviao(); // Atualiza a posição do avião
                // Desenha o avião
                desenharAviao(xAviao, yAviao, width, height);
                // Chama novamente o ciclo da animação
                detectarColisao();

                // Atualiza os pontos na tela
                ctx.fillStyle = 'white';
                ctx.font = '24px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('Pontos: ' + pontos, 10, 30);

                requestAnimationFrame(gameloop);
            } else {
                ctx.font = "40px Helvetica";
                ctx.fillStyle = 'red';
                ctx.fillText('WASTED', canvas.width / 2 - 150, canvas.height / 2)
            }
        }

        function iniciarJogo() {
            pontos = 0; // Reinicia os pontos
            tInicial = new Date().getTime(); // Inicia o tempo inicial
            gameOver = false; // Reseta o estado do jogo
            gameloop(); // Inicia o loop do jogo
        }
        window.onkeydown = pressionaTecla;

    function pressionaTecla(tecla) {
        if (tecla.keyCode == 38) {
            yAviao -= 10;
        }
        if (tecla.keyCode == 40) {
            yAviao += 10;
        }
        if (tecla.keyCode == 39) {
            xAviao += 10; //aumentar o x tem o efeito de ir para a direita
        }
        if (tecla.keyCode == 37) {
            xAviao -= 10; //diminuir o x tem o efeito de ir para a esquerda
        }
    }

    function moverAviao() {
        //atualiza a posição do avião com base nas teclas pressionadas
        //limita a posição do avião ao canvas
        if (xAviao < 0) {
            xAviao = 0;
        }
        if (xAviao > canvas.width - 100) {
            xAviao = canvas.width - 100;
        }
    }

    function desenharAviao(pX, pY, pW, pH) {
        var wAviao = new Image();
        wAviao.src = 'aviao.png'
        ctx.drawImage(wAviao, pX, pY, pW, pH);
    }

    function detectarColisao() {
        if (
            xAviao < x + width &&
            xAviao + width > x &&
            yAviao < y + height &&
            yAviao + height > y
        ) {
            gameOver = true;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = "40px Helvetica";
            ctx.fillStyle = 'yellow';
            ctx.fillText('WASTED', canvas.width / 2 - 100, canvas.height / 2);
        }
    }
    }

</script>

</html>